---
layout: post
title: PHP日常笔记
---

### PHP空数组转空对象

这个问题在与IOS、安卓客户端调试API的时候遇到，非空数组经过json_encode后会转为{}形式的对象（java里称字典）

而空数组会直接转成[]形式，这样造成客户端解析异常。

解决办法是在输出前强制转成object对象：

{% highlight php %}
<?php
$a =array();
var_dump($a);
echo json_encode($a);
echo "\n";
$b = (object)$a;
var_dump($b);
echo json_encode($b);
{% endhighlight %}

输出：

	array(0) {
	}
	[]
	object(stdClass)#1 (0) {
	}
	{}


#### round() 函数对浮点数进行四舍五入
语法

float round( float val ,[int precision] )

返回将 val 根据指定精度 precision（十进制小数点后数字的数目）进行四舍五入的结果。

precision 也可以是负数或零（默认值）。

### float精度丢失问题需要用BC函数库

要使用 BC 这个函数库，要在编译 PHP 程序时加入 --enable-bcmath 的选项。

    bcadd:	 将二个高精确度数字相加。
    bccomp:	 比较二个高精确度数字。
    bcdiv:	 将二个高精确度数字相除。
    bcmod:	 取得高精确度数字的余数。
    bcmul:	 将二个高精确度数字相乘。
    bcpow:	 求一高精确度数字次方值。
    bcscale: 配置程序中所有 BC 函数库的默认小数点位数。
    bcsqrt:	 求一高精确度数字的平方根。
    bcsub:	 将二个高精确度数字相减。


static的属性，在内存中只有一份，为所有的实例共用。

使用self:: 关键字访问当前类的静态成员

使用parent::调用父类方法

abstract 抽象类 抽象方法

### PHP 方法修饰符 ###

Public（公开）: 可以自由的在类的内部外部读取、修改。

Private（私有）: 只能在这个当前类的内部读取、修改。

Protected（受保护）：能够在这个类和类的子类中读取和修改。

Final (最终的) 不能被继承，也没有子类。


### PHP序列化函数： ###

serialize()和unserialize()：一个是进行序列化存储，另一个则是进行序列化恢复


### PHP instatnceof运算符保障代码安全 ###

使用instanceof运算符，可以判断当前实例是否可以有这样的一个形态。当前实例使用 instanceof与当前类，父类（向上无限追溯），已经实现的接口比较时，返回真。

代码格式：实例名 instanceof 类名


{% highlight php %}
<?php
class User{
	private $name;
	public function  getName(){
		return "UserName is ".$this->name;
	}
}

class NormalUser extends User {
	private $age = 99;
	public function getAge(){
		return "age is ".$this->age;
	}
}

class UserAdmin{ //操作.
	public static function  getUserInfo(User $_user){
		if($_user instanceof NormalUser ){
			echo $_user->getAge();
		}else{
			echo "类型不对,不能使用这个方法.";
		}
	}
}
$User = new User(); // 这里new的是User.
UserAdmin::getUserInfo($User);
?>
{% endhighlight %}

程序运行结果：

    类型不对,不能使用这个方法.

### PHP Ajax 跨域允许多个域名访问 ###

根据系统变量HTTP_ORIGIN请求头返回不同结果：

{% highlight php %}
<?php
$origin = isset($_SERVER['HTTP_ORIGIN'])? $_SERVER['HTTP_ORIGIN'] : '';  
  
$allow_origin = array(  
    'http://client1.malu.me',  
    'http://client2.malu.me' 
);
  
if(in_array($origin, $allow_origin)){  
    header('Access-Control-Allow-Origin:'.$origin);       
}
?>
{% endhighlight %}



