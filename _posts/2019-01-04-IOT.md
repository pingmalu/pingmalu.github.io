---
layout: post
title: IOT
---

# ESP8266

## 模拟输出 Analog output

analogWrite(pin, value) 

在已有的引脚上使能软件PWM功能。PWM可以用在引脚0~16。调用analogWrite(pin, 0) 可以关闭引脚PWM。取值范围：0~ PWMRANGE,默认为1023。 PWM 范围可以使用analogWriteRange(new_range)语句来更改。

PWM 默认频率：1KHz。使用analogWriteFreq(new_frequency) 可以更改频率。


# ESPEASY

## 定时触发hooks脚本

    on WiFi#Connected do
    timerSet,1,10
    endon

    On Rules#Timer=1 do
    SendToHTTP malu.me,80,/iot?domain=iotd1&ip=%ip%
    timerSet,1,100
    endon

## 定时睡眠

要启用深度睡眠，我们需要将RST引脚连接到ESP8266上的GPIO 16，在NodeMCU上，GPIO 16表示为D0；在D1上，GPIO 16表示为D2。

如果没有连接，将无法自动唤醒！！！

    On System#Boot do
    timerSet,2,60
    endon

    On Rules#Timer=2 do  //When Timer2 expires, do 启动60秒后，进入深度睡眠10秒，再启动，重复
    deepsleep,10
    endon

手动唤醒设备：RST拉至GND

## MQTT控制

controllers -> 编辑第一个 -> Protocol选择OpenHAB MQTT

    发布主题，即为控制端  Controller Subscribe: /%sysname%/# 

    比如发布一个主题：/test01/GPIO/2  Payload：0 ，给GPIO2低电平


    接收主题，即为信号返回  Controller Publish: /%sysname%/%tskname%/%valname%

    比如根据上面接收地址为：/test01/esp01/Switch 

    esp01为：devices -> task name为esp01

    Switch为：其Values的name

# esp_wifi_repeater

官网：[https://github.com/martin-ger/esp_wifi_repeater](https://github.com/martin-ger/esp_wifi_repeater)


中继配置：

    set ssid xxx
    set password xxx
    set automesh 1
    set hw_reset 5
    show
    save
    reset