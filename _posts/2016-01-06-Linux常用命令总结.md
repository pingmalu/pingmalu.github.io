---
layout: post
title: Linux常用命令总结
---
以下是平时用到的Linux命令（会不定期更新）


### 压缩工具

7z

安装：apt-get install p7zip p7zip-full p7zip-rar

解压：7z x xxx.7z


### 启动项管理工具 

	小工具 rcconf：
	#sudo apt-get rcconf
	#sudo apt-get install rcconf
	root 下运行: #sudo rcconf

	功能更全的工具：sysv-rc-conf
	#sudo apt-get update
	#sudo apt-get install sysv-rc-conf
	运行：#sudo sysv-rc-conf
	也可以直接加入启动程序，例如把 /etc/init.d/red5 加入到系统自动启动列表中：
	#sudo sysv-rc-conf red5 on


### Linux后台进程管理利器：supervisor

安装

	apt-get install supervisor

配置文件（每个进程的配置文件都可以单独分拆，放在/etc/supervisor/conf.d/目录下，以.conf作为扩展名，例如，app.conf定义了一个gunicorn的进程）：
	
	[program:app]
	command=/usr/bin/gunicorn -w 1 wsgiapp:application
	directory=/srv/www
	user=www-data

其中，进程app定义在[program:app]中，command是命令，directory是进程的当前目录，user是进程运行的用户身份。

重启supervisor，让配置文件生效，然后运行命令supervisorctl启动进程：

	supervisorctl start app

停止进程：

	supervisorctl stop app

*报错： unix:///var/run/supervisor.sock no such file

	sudo touch /var/run/supervisor.sock
	sudo chmod 777 /var/run/supervisor.sock
	sudo service supervisor restart


官方文档：[http://supervisord.org/](http://supervisord.org/)

### MD5

根据字符串输出一段md5值：

	echo -n 'hello'|md5sum|cut -d ' ' -f1


### Screen

启动会话

	[root@malu ~]# screen

	[root@malu ~]# screen -ls
	There is a screen on:
	        123.pts-1.malu      (Detached)
	1 Socket in /tmp/screens/S-root.
	重新连接会话：
	[root@malu ~]# screen -r 123

可以通过C-a ?来查看所有的键绑定，常用的键绑定有：

> C-a ?	显示所有键绑定信息
> 
> C-a w	显示所有窗口列表
> 
> C-a C-a	切换到之前显示的窗口
> 
> C-a c	创建一个新的运行shell的窗口并切换到该窗口
> 
> C-a n	切换到下一个窗口
> 
> C-a p	切换到前一个窗口(与C-a n相对)
> 
> C-a 0..9	切换到窗口0..9
> 
> C-a a	发送 C-a到当前窗口
> 
> C-a d	暂时断开screen会话
> 
> C-a k	杀掉当前窗口
> 
> C-a [	进入拷贝/回滚模式

### CentOS安装redis

    yum install epel-release
    yum install list
    yum install redis

### sed 命令

	插入到最后一行
	sed -i '$a\要插入的文字' file.txt
	使用 -i 选项直接修改文件。
	$ 匹配文件的最后一行位置
	a 命令在后面append

    *其实可以这样：
    echo '要插入的文字' >> file.txt

    插入到第一行
	sed -i '1i\要插入的文字' file.txt

    替换一行文字
    sed -i 's/^被替换的文字/要替换的文字/' file.txt

	匹配一行后追加文字
	sed -i 's/关键字/&要追加的文字/g' file.txt

	在每行的头添加字符，比如"HEAD"，命令如下：
	
	sed 's/^/HEAD&/g' file.txt
	
	在每行的行尾添加字符，比如“TAIL”，命令如下：
	
	sed 's/$/&TAIL/g' file.txt

	"^"代表行首，"$"代表行尾


### 把错误输出到标准输出：2>&1

	2> 表示把标准错误(stderr)重定向，尖括号后面可以跟文件名，或者是&1, &2，分别表示重定向到标准输出和标准错误。

### nohup后台执行

	nohup command > myout.file 2>&1 &

在上面的例子中，输出被重定向到myout.file文件中。 　　

使用 jobs 查看任务。 　　

使用 fg %n　关闭


### 监视某进程的资源占用情况(pid进程id)：

    ps -p pid
    
### 在目录中找指定后缀的文件内容包含某个关键字的：

    find ./ -name "*.php"|xargs grep -n xxx

### grep匹配上下文

grep -C 5 foo file  显示file文件中匹配foo字串那行以及上下5行

grep -B 5 foo file  显示foo及前5行

grep -A 5 foo file  显示foo及后5行

### scp命令 ###

scp -P 4588 root@www.abc.com:/root/sn.sh /home/admin

-r 递归目录
    
-v 和大多数 linux 命令中的 -v 意思一样 , 用来显示进度 . 可以用来查看连接 , 认证 , 或是配置错误 . 

-C 使能压缩选项 . 

-P 选择端口 . 注意 -p 已经被 rcp 使用 . 

-4 强行使用 IPV4 地址 . 

-6 强行使用 IPV6 地址 .

### mount挂载目录 

	//挂载exfat
	mount -t exfat -o iocharset=cp936 /dev/sdb1


### 获取BGP骨干网IP地址

	//facebook
    whois -h whois.radb.net -i origin AS32934|grep ^route

    //谷歌 GAE解析地址:ghs.googlehosted.com
    whois -h whois.radb.net -i origin AS15169|grep ^route

    //[Incapsula](http://bgp.he.net/AS19551)
    whois -h whois.radb.net -i origin AS19551|grep ^route

    //cloudflare 节点众多，用这个查吧
	http://bgp.he.net/search?search%5Bsearch%5D=cloudflare

### ln建立文件系统链接

给网站目录建立软连接:

	ln -s /app/www /var/www/html


### 按行数切割文件

	split access.log.1 -l 100000 -d -a 2 access_ && ls|grep access_|xargs -n1 -i{} mv {} {}.log

说明：

-l：按行分割，上面表示将access.log.1文件按100000行一个文件分割为多个文件

-d：添加数字后缀，如00，01，02

-a 2：表示用两位数据来顺序命名

# ssh

ssh连接的时候会出现：

	The authenticity of host 'ssh.malu.me (14.17.80.36)' can't be established.
	RSA key fingerprint is cf:ee:17:cb:2e:fc:12:d7:72:7e:ae:80:c0:91:88:a7.
	Are you sure you want to continue connecting (yes/no)?

提示用户该指纹密钥需要确认才能继续连接，一般选yes就过了。

但是有些特殊情况不需要显示这个提示，那么需要在连接命令添加-o参数：

	ssh -o "StrictHostKeyChecking no" user@host

或者修改 /etc/ssh/ssh_config 全局配置文件 或 ~/.ssh/config 用户配置文件：

	Host *
	   StrictHostKeyChecking no

