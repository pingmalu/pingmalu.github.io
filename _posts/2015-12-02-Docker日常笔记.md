---
layout: post
title: Docker日常笔记
---

### 快速安装

	apt-get -y install docker.io

### 从本地提交镜像
 
	1. 登录私有镜像仓库
	docker login -u [用户名] -p [密码] -e [电子邮件] https://xxx.com
	2. 给本地host的镜像打tag
	docker tag [镜像ID] xxx.com/[用户名]/[镜像名称:标签]
	3. 推送镜像到私有仓库
	docker push xxx.com/[用户名]/[镜像名称:标签]

查看镜像

	docker images

删除镜像

	docker rmi [镜像名称:标签]

拉取镜像

	docker pull [镜像路径]

登录daocloud帐号：

	docker login daocloud.io

运行镜像：

	docker run -d -p [外网端口]:[镜像端口] -e [环境变量] [镜像ID]


查看运行中的docker：

	docker ps

查看所有启动过的docker：

	docker ps -a

停止/启动docker：

	docker stop  [docker运行ID]
	docker start [docker运行ID]

登录容器：

	docker exec -it [container_id] /bin/bash

查看容器日志：

	docker logs [docker运行ID]

添加新用户：

	useradd -r -m -s /bin/bash

# 备份迁移

打包成tar

	docker save -o filename.tar [镜像ID]

恢复打包文件

	docker load -i filename.tar


重命名容器名：

	root@ubuntu:~# docker ps -a
	CONTAINER ID        IMAGE                 COMMAND               CREATED             STATUS                    PORTS                    NAMES
	ec7d53c91621        70683c8feae9:latest   "/run.sh"             2 hours ago         Exited (64) 2 hours ago                            goofy_stallman      
	0a3869ba2838        b9ec47bb8b8d:latest   "/run.sh"             22 hours ago        Up 2 hours                0.0.0.0:9221->9200/tcp   logstash            
	3ad0379db41d        70683c8feae9:latest   "/run.sh"             25 hours ago        Exited (0) 25 hours ago                            cranky_rosalind     
	6d829565caf4        f9aabae65d48:latest   "/usr/local/run.sh"   28 hours ago        Exited (0) 5 hours ago                             naughty_curie       
	root@ubuntu:~# docker rename goofy_stallman one
	root@ubuntu:~# docker ps -a
	CONTAINER ID        IMAGE                 COMMAND               CREATED             STATUS                    PORTS                    NAMES
	ec7d53c91621        70683c8feae9:latest   "/run.sh"             2 hours ago         Exited (64) 2 hours ago                            one                 
	0a3869ba2838        b9ec47bb8b8d:latest   "/run.sh"             22 hours ago        Up 2 hours                0.0.0.0:9221->9200/tcp   logstash            
	3ad0379db41d        70683c8feae9:latest   "/run.sh"             25 hours ago        Exited (0) 25 hours ago                            cranky_rosalind     
	6d829565caf4        f9aabae65d48:latest   "/usr/local/run.sh"   28 hours ago        Exited (0) 5 hours ago                             naughty_curie 


### aufs文件系统安装 ###

http://cloud.51cto.com/art/201412/461261.htm

### 生成requirements.txt文件： ###

    pip install redis
    pip freeze > requirements.txt

# docker容器故障致无法启动解决办法

首先通过启动日志查看问题原因：

	docker logs [docker运行ID]

然后根据问题，到启动数据/var/lib/docker/aufs/diff/路径下。

比如我遇到Nginx启动失败，那就查找nginx配置文件：

	root@ubuntu:/var/lib/docker/aufs/diff# find ./ -name 'nginx.conf'
	./399145668ccb628a0a9cc572431b93c17a72f84625d8430d9897fd46e572f4dd/etc/nginx/nginx.conf
	./0609441079c15cc8214d1f55bdcdb270da9b94008e4432f81d98a96460f54f25/etc/nginx/nginx.conf

然后去修改对应问题。


参考文档：http://dockerpool.com/static/books/docker_practice/index.html