---
layout: post
title:  "MySQL线上与本地主从同步"
---

### 运行环境：

线上：RDS（内网）+ECS  

本地：xampp

由于本地只能访问ECS，需要在ECS上架设mysql代理：

参考这篇笔记：[http://git.malu.me/MySQL-Proxy/](http://git.malu.me/MySQL-Proxy/)

### ECS配置（作为主服务器master）:

修改配置文件:

	#vim /etc/my.cnf
    
       [mysqld]
       log-bin=mysql-bin   //[必须]启用二进制日志
       server-id=1         //[必须]服务器唯一ID，默认是1

重启mysql：

	/etc/init.d/mysql restart

在主服务器上建立帐户mysync并授权给slave主机:

	mysql -uroot -h localhost

	mysql> GRANT REPLICATION SLAVE ON *.* to 'mysync'@'%' identified by 'passwd';

	mysql> show master status;    #查看master的状态
	+------------------+----------+--------------+------------------+
	| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB |
	+------------------+----------+--------------+------------------+
	| mysql-bin.000002 |      532 |              |                  |
	+------------------+----------+--------------+------------------+
	1 row in set (0.00 sec)

	注：执行完此步骤后不要再操作主服务器MYSQL，防止主服务器状态值Position变化

### 本地xampp配置（作为从服务器slave）：

修改配置文件:

	X:\Xampp\mysql\bin\my.ini   #xampp默认配置文件

    [mysqld]
    log-bin=mysql-bin   //[不是必须]启用二进制日志
    server-id=2         //[必须]服务器唯一ID，默认是1，不要与master一样

配置Slave：

	mysql> change master to  master_host='mysql.malu.me',master_port=3306,master_user='mysync',master_password='passwd',master_log_file='mysql-bin.000001',master_log_pos=532;

