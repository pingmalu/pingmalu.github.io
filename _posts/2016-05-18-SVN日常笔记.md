---
layout: post
title: SVN日常笔记
---

这里记录SVN日常使用的技巧

### 统计用户一段时间内修改了哪些文件

比如要看从5月1号到18号我的修改记录

	svn log -r {2016-5-1}:{2016-5-19} --search malu -v -q

> -v 显示改动文件列表
> 
> -q 简化返回内容（去除了注释）

当然这不是最终想要的，接下来拿出强大的vim编辑器：

把结果导出或者copy到文本中，用vim打开：

先把杂项过滤（保留文件列表）：

	:g!/^   /d

删除不含字符串'空格空格空格'开头的行（^后是三个空格），表以三个空格开头的行都保留。

接下来Ctrl+v进入行编辑模式，把前面空格和M、A等前缀删掉。

然后排序：

	:sort

这一步是必须的，因为删除重复行只能去除相邻的。

然后删除重复行：

	:g/^\(.*\)$\n\1$/d

完成。

**注：以上终端下操作较为复杂，建议在windows图形界面操作方便快捷。（svn log ->过滤用户名、日期->选中所有->复制path里的所有->完成）**


# svn服务端

## svn钩子

启动服务：

	svnserve -d -r /svn/

进目录：

	cd /svn/hooks/


vim post-commit

	#!/bin/bash
	export LANG=en_US.UTF-8
	export PATH=$PATH:/var/www/console
	/usr/bin/svn update /var/www --username malu --password xxx

给post-commit执行权限

	chmod 777 post-commit
	
## SVN钩子根据项目路径触发调取jenkins自动构建脚本

{% highlight shell %}
#!/bin/bash
REPOS="$1"
TXN="$2"
CURDATE=`date`

PROJECTPATH=Projects/taifeng

SVNLOOK=/usr/bin/svnlook

NEW_VER=`$SVNLOOK youngest $REPOS`

FILELIST=`$SVNLOOK changed  -r $NEW_VER $REPOS`
USERNAME=`$SVNLOOK author -r $NEW_VER $REPOS`

$SVNLOOK changed  -r $NEW_VER $REPOS | while read line;do
        if [[ $line =~ $PROJECTPATH ]];then
                echo "$TXN $USERNAME Deployed at $CURDATE" >> /home/svnhooks.log
                wget -q http://svn.malu.me/job/php/build?token=8f7sdf23sdfsdfasd19 &
                exit
        fi
done
{% endhighlight %}

