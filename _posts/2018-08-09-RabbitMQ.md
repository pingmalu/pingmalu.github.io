---
layout: post
title:  "RabbitMQ"
---

# Ubuntu下快速安装：

	apt install rabbitmq-server

# rabbitmqctl基本操作

	# 查看当前所有用户
	
	$ rabbitmqctl list_users
	 
	# 查看默认guest用户的权限
	$ rabbitmqctl list_user_permissions guest
	 
	# 由于RabbitMQ默认的账号用户名和密码都是guest。为了安全起见, 先删掉默认用户
	$ rabbitmqctl delete_user guest
	 
	# 添加新用户
	$ rabbitmqctl add_user username password
	 
	# 新增管理员用户
	$ rabbitmqctl set_user_tags username administrator
	 
	# 赋予用户默认vhost的全部操作权限
	$ rabbitmqctl set_permissions -p / username ".*" ".*" ".*"
	 
	# 查看用户的权限
	$ rabbitmqctl list_user_permissions username

	# 列出所有队列
	$ rabbitmqctl list_queues

	# 查看未确认队列
	$ rabbitmqctl list_queues name messages_ready messages_unacknowledged

	# 列出服务器上所有的交换器  直连交换机（direct）, 主题交换机（topic）, （头交换机）headers和 扇型交换机（fanout）
	$ rabbitmqctl list_exchanges

	# 列出所有现存的绑定
	$ rabbitmqctl list_bindings

	# 查看运行信息，版本等信息
	$ rabbitmqctl status

# 配置文件 /etc/rabbitmq/rabbitmq-env.conf

可以修改NODE_PORT来改变默认监听端口（默认5672）

也可修改/etc/rabbitmq/rabbitmq.config

	[
	{rabbit, [{tcp_listeners, [5670]}]}
	].

如果两个文件中都进行了配置，rabbitmq会优先使用rabbtmq-env.conf中变量NODE_PORT的值作为真正的侦听端口。


# 开启web管理

	rabbitmq-plugins enable rabbitmq_management

## web管理配置文件

在/etc/rabbitmq/rabbitmq.config文件里

### 修改web管理端口（默认web管理端口15672）

	[{rabbitmq_management, [{listener, [{port, 12345}]}]}].

### 开启guest远程访问（默认密码：guest）

	[{rabbit, [{loopback_users, []}]}].

### 最终配置

	[
		{rabbitmq_management, [{listener, [{port, 11131}]}]},
		{rabbit, [{tcp_listeners, [11130]},{loopback_users, []}]}
	].
