---
layout: post
title: 构建ELK+Redis日志分析系统
---

安装Logstash+ElasticSearch5+Kibana5

# JDK

最新版elasticsearch-5.0.0-alpha4需要java-1.8，

首先下载jdk-1.8，下载地址：[http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html
](http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html)

解压安装：

	tar -zxvf jdk-8u92-linux-x64.tar.gz
	mkdir /usr/local/java
    mv jdk1.8.0_92 /usr/local/java/

设置环境变量：

vim ~/.bashrc 追加：

	export JAVA_HOME=/usr/local/java/jdk1.8.0_92
	export JRE_HOME=${JAVA_HOME}/jre  
	export CLASSPATH=.:${JAVA_HOME}/lib:${JRE_HOME}/lib  
	export PATH=${JAVA_HOME}/bin:$PATH

验证安装版本：

	root@ubuntu:~# java -version
	java version "1.8.0_92"
	Java(TM) SE Runtime Environment (build 1.8.0_92-b14)
	Java HotSpot(TM) 64-Bit Server VM (build 25.92-b14, mixed mode)

# ElasticSearch5

ElasticSearch官方下载:[https://www.elastic.co/downloads/elasticsearch](https://www.elastic.co/downloads/elasticsearch)

官方提供deb包，那就偷懒下 [elasticsearch-5.0.0-alpha4.deb](https://download.elastic.co/elasticsearch/release/org/elasticsearch/distribution/deb/elasticsearch/5.0.0-alpha4/elasticsearch-5.0.0-alpha4.deb)

安装：

	dpkg -i elasticsearch-5.0.0-alpha4.deb

默认安装在/usr/share/elasticsearch 目录

启动：

	cd /usr/share/elasticsearch/
	mkdir config
	cd bin/
	./elasticsearch

错误：

如果报错：

	Exception in thread "main" java.lang.RuntimeException: can not run elasticsearch as root

那么切换到普通用户

如果还报错：

	Exception in thread "main" java.lang.IllegalStateException: Unable to access 'path.conf' (/usr/share/elasticsearch/config)

是因为访问权限不够：

	chown malu /usr/share/elasticsearch -R

中文文档：[http://learnes.net/](http://learnes.net/)

# Kibana5

Kibana官方下载: [https://www.elastic.co/downloads/kibana](https://www.elastic.co/downloads/kibana)

deb包下载： [kibana-5.0.0-alpha4-amd64.deb](https://download.elastic.co/kibana/kibana/kibana-5.0.0-alpha4-amd64.deb)

安装：

	dpkg -i kibana-5.0.0-alpha4-amd64.deb

默认安装在/usr/share/kibana

启动：

	cd /usr/share/kibana/bin
	./kibana

中文文档：[http://www.code123.cc/docs/kibana-logstash/](http://www.code123.cc/docs/kibana-logstash/)

# logstash5

官方下载：[https://www.elastic.co/downloads/logstash](https://www.elastic.co/downloads/logstash)

deb下载：[logstash-5.0.0-alpha4.deb](https://download.elastic.co/logstash/logstash/packages/debian/logstash-5.0.0-alpha4.deb)

安装：

	dpkg -i logstash-5.0.0-alpha4.deb

默认安装在/usr/share/logstash

启动：

首先需要配置运行文件：

vim /etc/logstatsh/conf.d/first-pipeline.conf

	input {
	    file {
	        path => "/var/log/nginx/access.log"
	        start_position => beginning
	        ignore_older => 0
	    }
	}
	filter {
	    grok {
	        match => { "message" => "%{COMBINEDAPACHELOG}"}
	    }
	    geoip {
	        source => "clientip"
	    }
	}
	output {
	    elasticsearch {
	        hosts => [ "localhost:9200" ]
	    }
	}

启动前可以用命令检查一下参数是否正确：

	bin/logstash -f first-pipeline.conf --config.test_and_exit

然后执行：

	/usr/share/logstash/bin/logstash
	
此时会读取logstash默认配置文件 /usr/share/logstash/config/logstash.yml

如果不存在，请从/etc/logstash/logstash.yml复制



# redis

参考这篇文章：[http://git.malu.me/Redis客户端常用命令/](http://git.malu.me/Redis%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/)




# Other


高性能的PHP日志系统—SeasLog

